<html>
<script type="text/javascript" src="https://fliegenfuerst.github.io/dmw/tournament/1.4/js/data/digimonStats.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>
<button id="showNextDigiButton">show next</button>
<div id="name"></div>
<div class="fill" align="center">
  <canvas id="canvas" width="18" height="18"></canvas>
</div>
<style>
@import url("http://necolas.github.io/normalize.css/3.0.1/normalize.css");

.hide {
  display: none;
}

.logo {
  text-align: center;
}

.fill {
  width: 100%;
}

.fr {
  float: right;
}
</style>
<script>
class Sprite{
	constructor(name, blob){
		this.saveName = name;
		this.blob = blob;
	}
}

function downloadBlob(blob, filename){
	let link = document.createElement('a');
	link.style.display = 'none';
	document.body.appendChild(link);
	link.href = URL.createObjectURL(blob);
	link.download = filename;
	link.click();
	document.body.removeChild(link);
}


const digiName = document.getElementById("name");
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext("2d");
const showNextDigiButton = document.getElementById("showNextDigiButton");
showNextDigiButton.onclick = showNextDigi;
let backgroundImg = new Image();
let spriteImg = new Image();
const sprites = [];
backgroundImg.crossOrigin="anonymous"
spriteImg.crossOrigin="anonymous"
backgroundImg.src = 'https://fliegenfuerst.github.io/dw1/stat_tool/bg_box.png';
spriteImg.src = 'https://fliegenfuerst.github.io/dmw/tournament/1.4/css/digisprites.png';

function showDigi(id){
	let digi = digimonStats[id];
	ctx.drawImage(backgroundImg, 0, 0);
	ctx.drawImage(spriteImg, 32 * digi.id, 0, 16, 16, 1, 1, 16, 16);
	digiName.innerText = digi.name;
	
}

async function storeDigi(digi){
	ctx.drawImage(backgroundImg, 0, 0);
	ctx.drawImage(spriteImg, 32 * digi.id, 0, 16, 16, 1, 1, 16, 16);
	digiName.innerText = digi.name;
	const blob = await new Promise(res => canvas.toBlob(res));
	sprites.push(new Sprite(digi.name + ".png", blob));
}

var id = 0;
async function showNextDigi(){
	for(let i = 0; i < 128; i++){
		await storeDigi(digimonStats[i]);
	}
  
	var zip = new JSZip();

	for(let sprite of sprites){
		zip.file(sprite.saveName, sprite.blob);
	}
	downloadBlob(await zip.generateAsync({ type: "blob" }), "sprites.zip");
}
</script>
</html>
